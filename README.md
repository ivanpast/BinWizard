# Interactive Binning Tool

This repository contains a Python-based interactive binning tool built using Streamlit, which allows users to upload a dataset, perform optimal binning on a selected numerical variable against a target variable, and analyze the results interactively. The tool supports continuous target variables and provides functionality for automatic and manual binning, as well as the calculation of key metrics like Somers' D and the Herfindahl-Hirschman Index (HHI).

it is mainly based on the OptBinning packaged developed by Guillermo Navas Palencia (https://github.com/guillermo-navas-palencia/optbinning). This package attempts to create a tool for manually change potential 
bins of variables as it is usually done in many machine learning applications. 


### Installation

You can install the required packages using `pip`:

```bash
pip install streamlit pandas numpy optbinning scipy matplotlib seaborn

```


## Features

- **Automatic Binning**: Perform optimal binning using `ContinuousOptimalBinning` from the `optbinning` library.
- **Manual Bin Adjustment**: Manually adjust the binning by selecting and combining bins.
- **Metrics Calculation**: Calculate and display key metrics such as Somers' D and HHI.
- **Data Visualization**: Visualize the distribution of the binned data using violin plots, including p-values for adjacent bins.
- **Downloadable Results**: Download the binning results as an Excel file.

## How to launch it

 pip install git+https://github.com/ivanpast/BinWizard.git


Once the package is installed to launch two functions are easily executed by opening a cmd window and just write:

- binGUI : To run binnings if the target variable has only two different values
- contGUI: For binning continuous variables


It can be seen as weird but this procedure is because Streamlit, who is the visual platform cannot be run in notebooks



## How It Works

### 1. File Upload

Users start by uploading a data file. Supported file formats include:
- CSV (`.csv`)
- Excel (`.xlsx`, `.xls`)
- SAS (`.sas7bdat`)

The uploaded data is loaded into a pandas DataFrame for further processing.

### 2. Variable Selection

After the data is loaded, users can select a numerical variable to bin and a target variable (which should also be numerical) for the binning process.

### 3. Binning Configuration

Users can configure the binning process with the following options:
- **Maximum number of bins**: The maximum number of bins to create.
- **Minimum bin size**: The minimum size of each bin as a percentage of the total dataset.
- **Monotonic trend**: Users can specify whether the bins should follow a monotonic trend (ascending, descending, convex, concave) or be automatically determined.

### 4. Automatic Binning

The tool uses `ContinuousOptimalBinning` from the `optbinning` library to perform optimal binning on the selected variable. The binning process is based on the configuration parameters and results in the automatic creation of bins.

### 5. Metrics Calculation

The tool calculates and displays the following metrics:
- **Somers' D**: A measure of association between the binned variable and the target variable.
- **Herfindahl-Hirschman Index (HHI)**: A measure of the concentration of data points within the bins, indicating the distribution's competitiveness or concentration.

### 6. Visualization

The tool provides a visual representation of the binned data using violin plots. These plots display the distribution of data within each bin and include p-values for statistical significance between adjacent bins.

### 7. Manual Binning Adjustment

Users can manually adjust the binning by selecting specific splits to remove and combining the remaining bins. The tool recalculates the metrics and updates the visualizations accordingly.

### 8. Download Results

After performing the binning, users can download the results as an Excel file. The file includes the original data with the assigned bin labels.

## Main Functions

### `generate_excel(df, filename="binning_results.xlsx")`
Generates an Excel file containing the DataFrame `df` with the binning results. The file can be downloaded by the user.

### `download_button(data, filename, label)`
Creates a Streamlit button that allows users to download the Excel file generated by `generate_excel`.

### `interactive_binning(df)`
The core function that handles the interactive binning process. It guides the user through selecting variables, configuring binning, performing automatic and manual binning, and visualizing the results.

### `validate_splits(splits)`
Validates and cleans the binning splits by removing duplicates and NaN values, and ensuring the inclusion of the entire range of values.

### `combine_splits(splits, selected_splits)`
Combines all the splits except the ones selected by the user for removal, effectively allowing manual adjustment of the bins.

### `calculate_metrics_continuous(df, continuous_var, target_var, splits)`
Calculates metrics such as the mean and variance of the target variable within each bin, and also calculates Somers' D and HHI for the binned data.

### `calculate_herfindahl(table)`
Calculates the Herfindahl-Hirschman Index (HHI) based on the frequency distribution of the data within the bins.

### `calculate_somersd(df, continuous_var, target_var, splits)`
Calculates Somers' D, a measure of association between the continuous variable and the target variable based on the binning.

### `plot_violinplots_with_pvalues(df, continuous_var, target_var)`
Creates violin plots to visualize the distribution of data within each bin. P-values are displayed for the differences between adjacent bins.

### `main()`
The main function that sets up the Streamlit interface and handles the file upload process.

## Getting Started

### Prerequisites

To run the tool locally, you will need Python 3.x and the following Python libraries:
- Streamlit
- Pandas
- Numpy
- OptBinning
- Scipy
- Matplotlib
- Seaborn



